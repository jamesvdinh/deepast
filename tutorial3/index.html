<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorial3" data-theme="dark" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Tutorial: Segmentation and Flattening | Deep Past Challenge</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="description" content="A $1,000,000+ machine learning and computer vision competition"><meta data-rh="true" property="og:type" content="website"><meta data-rh="true" property="og:url" content="https://scrollprize.org"><meta data-rh="true" property="og:title" content="Deep Past Challenge"><meta data-rh="true" property="og:description" content="A $1,000,000+ machine learning and computer vision competition"><meta data-rh="true" property="og:image" content="https://scrollprize.org/img/social/opengraph.jpg"><meta data-rh="true" property="twitter:card" content="summary_large_image"><meta data-rh="true" property="twitter:url" content="https://scrollprize.org"><meta data-rh="true" property="twitter:title" content="Deep Past Challenge"><meta data-rh="true" property="twitter:description" content="A $1,000,000+ machine learning and computer vision competition"><meta data-rh="true" property="twitter:image" content="https://scrollprize.org/img/social/opengraph.jpg"><link data-rh="true" rel="icon" href="/deeppast/img/social/favicon.ico"><link data-rh="true" rel="canonical" href="https://jamesvdinh.github.io/deeppast/tutorial3"><link data-rh="true" rel="alternate" href="https://jamesvdinh.github.io/deeppast/tutorial3" hreflang="en"><link data-rh="true" rel="alternate" href="https://jamesvdinh.github.io/deeppast/tutorial3" hreflang="x-default"><script src="https://cdn.usefathom.com/script.js" data-site="XERDEBQR" defer="defer" data-spa="auto"></script><link rel="stylesheet" href="/deeppast/assets/css/styles.bef91d10.css">
<script src="/deeppast/assets/js/runtime~main.83ce4c2b.js" defer="defer"></script>
<script src="/deeppast/assets/js/main.c0cb568b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/deeppast/"><div class="navbar__logo"><img src="/deeppast/img/social/favicon-64x64.png" alt="Deep Past Challenge Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/deeppast/img/social/favicon-64x64.png" alt="Deep Past Challenge Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Deep Past Challenge</b></a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col"><div class="docItemContainer_Djhp"><article><div class="theme-doc-markdown markdown"><header><h1>Tutorial: Segmentation and Flattening</h1></header>
<!-- -->
<div class="mx-[-16px] sm:mx-0 flex flex-wrap items-start mb-4 text-center justify-center sm:justify-start"><a href="/tutorial1" class="mb-2 flex flex-col items-center w-[100px] sm:w-[150px] relative box-content p-2 sm:p-4 sm:pb-2 hover:bg-[#fefefe26] rounded-xl"><video autoplay="" playsinline="" loop="" muted="" class="w-[100%] rounded-xl mb-2" poster="/img/tutorial-thumbs/top-scanning-small.webp"><source src="/img/tutorial-thumbs/top-scanning-small.webm" type="video/webm"></video><div class="text-sm">Scanning</div></a><div class="hidden sm:flex mx-2 mb-2 flex-col items-center"><div class="relative leading-[150px] py-4 w-[16px] text-center">→</div><div class="text-sm"> </div></div><a href="/tutorial3" class="mb-2 flex flex-col items-center w-[100px] sm:w-[150px] relative box-content p-2 sm:p-4 sm:pb-2 hover:bg-[#fefefe26] rounded-xl bg-[#fffefc30] hover:bg-[#fefefe45]"><video autoplay="" playsinline="" loop="" muted="" class="w-[100%] rounded-xl mb-2" poster="/img/tutorial-thumbs/top-segmentation-small.webp"><source src="/img/tutorial-thumbs/top-segmentation-small.webm" type="video/webm"></video><div class="text-sm">Segmentation and Flattening</div></a><div class="hidden sm:flex mx-2 mb-2 flex-col items-center"><div class="relative leading-[150px] py-4 w-[16px] text-center">→</div><div class="text-sm"> </div></div><a href="/tutorial4" class="mb-2 flex flex-col items-center w-[100px] sm:w-[150px] relative box-content p-2 sm:p-4 sm:pb-2 hover:bg-[#fefefe26] rounded-xl"><img class="max-h-[300px] m-2" src="/img/tutorials/fisherman.webp"><div class="text-sm">Segmentation - a different approach</div></a><div class="hidden sm:flex mx-2 mb-2 flex-col items-center"><div class="relative leading-[150px] py-4 w-[16px] text-center">→</div><div class="text-sm"> </div></div><a href="/tutorial5" class="mb-2 flex flex-col items-center w-[100px] sm:w-[150px] relative box-content p-2 sm:p-4 sm:pb-2 hover:bg-[#fefefe26] rounded-xl"><video autoplay="" playsinline="" loop="" muted="" class="w-[100%] rounded-xl mb-2" poster="/img/tutorial-thumbs/top-prediction-small3.webp"><source src="/img/tutorial-thumbs/top-prediction-small.webm" type="video/webm"></video><div class="text-sm">Ink Detection</div></a></div>
<p>This tutorial walks through a slice-based approach to segmentation, which is helpful background for learning about the task.
This was used to generate the 2023 <a href="/deeppast/grandprize">Grand Prize results</a>.
We are now working on more automated, 3D approaches to segmentation.
For more information on those approaches, see <a href="/deeppast/tutorial4">Segmentation - a different approach</a>.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Please see the accompanying video tutorial for segmentation using Volume Cartographer here: <a href="https://www.youtube.com/watch?v=gdQmepxWhuY" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=gdQmepxWhuY</a></p></div></div>
<p>As we saw in the <a href="/deeppast/tutorial1">&quot;Scanning&quot; tutorial</a>, it’s quite hard to extract useful information out of a “word soup”, even when the ink is quite clear. For this tutorial we’ll show how to use virtual unwrapping to produce a flattened image which shows the content clearly.</p>
<p>Two key steps to virtually unwrapping a scroll or manuscript are <em>segmenting</em> a surface from inside the 3D volume and <em>flattening</em> that surface to 2D. The video below shows the idea quite well; or check out the <a href="https://youtu.be/VG8oOMHCg74?t=37">full version</a> (It was made by Dr. Seales’s son and daughter!). The red line during the reconstruction phase represents the surface that we want to virtually unwrap.</p>
<figure><video autoplay="" playsinline="" loop="" muted="" controls="" class="w-[100%]" poster="/img/tutorials/pi-symbol3.webp"><source src="/img/tutorials/pi-symbol3.webm" type="video/webm"></video><figcaption class="mt-0">The basic principle of “virtual unwrapping” <a href="https://youtu.be/VG8oOMHCg74?t=38">(source)</a></figcaption></figure>
<p>To perform segmentation, you have two choices of software: Khartes, and Volume Cartographer. Both of these choices have different strengths and weaknesses, but either can accomplish the task of accurate segmentation. Khartes relies on Volume Cartographer to perform the flattening portion of this guide. Thanks to @hari_seldon and @djosey of the segmentation team for their feedback and help with making this guide!</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Volume Cartographer</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Khartes</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>Strengths:</p><ul>
<li>Faster at creating larger segments</li>
<li>tool-assisted annotation, requiring less clicking</li>
<li>Entire pipeline in one application</li>
<li>No shape limitation (lines can turn in on themselves, can be fully circular)</li>
</ul><p>Weaknesses:</p><ul>
<li>Can only segment on the Z plane, which is a challenge in some areas</li>
<li>No preview during segmentation</li>
<li>Relatively high hardware requirements</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Strengths:</p><ul>
<li>View z, x, and y planes and segment on any of them</li>
<li>Interactive full scroll movement through ome-zarr</li>
<li>Minimal hardware requirements</li>
<li>Live view of segmentation results, enabling very high accuracy</li>
</ul><p>Weaknesses:</p><ul>
<li>Is limited to creating segments that do not contain lines that turn back towards their origin, in essence limiting you to half circles at most. This can be severely limiting in some regions that have severe warping, and its hard to tell when you begin if a sheet will do this eventually.</li>
<li>Requires much more manual clicking than VC</li>
<li>Requires VC in some parts of the rendering / flattening pipeline</li>
</ul></div></div></div>
<p>Khartes is written by @khartes_chuck and has extensive documentation on github located <a href="https://github.com/KhartesViewer/khartes" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>This guide will focus on <a href="https://github.com/educelab/volume-cartographer" target="_blank" rel="noopener noreferrer">Volume Cartographer</a>, a virtual unwrapping toolkit built by EduceLab’s Seth Parker. Volume Cartographer is designed to create meshes along surfaces of a manuscript (e.g. pages or scroll wraps) and then sample the voxels around these meshes to create a 2D image of the manuscript&#x27;s contents. Volume Cartographer includes many tools and utilities. In this tutorial we’ll be looking at the main VC GUI as well as the vc_render tool.</p>
<p>The segmentation team uses a custom version of Volume Cartographer, initially forked by @RICHI and further enhanced by @spacegaier. These versions include significant improvements, such as Optical Flow Segmentation (OFS), substantial performance increases, ui improvements, and many other changes. The latest fork, maintained by @spacegaier, is available here: <a href="https://github.com/spacegaier/volume-cartographer" target="_blank" rel="noopener noreferrer">https://github.com/spacegaier/volume-cartographer</a>.</p>
<p>This guide uses this same version of VC. If you use a different version this guide will vary significantly from your experience, so it is highly recommended to use this version.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-volume-cartographer">Installing Volume Cartographer<a href="#installing-volume-cartographer" class="hash-link" aria-label="Direct link to Installing Volume Cartographer" title="Direct link to Installing Volume Cartographer">​</a></h3>
<p>To begin, let&#x27;s install Volume Cartographer:</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>OS-specific instructions</div><div class="admonitionContent_BuS1"><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Windows</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">macOS (using Homebrew)</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">macOS (using Docker)</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Linux</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Build from source</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><ol>
<li>Install the <a href="https://sourceforge.net/projects/vcxsrv/" target="_blank" rel="noopener noreferrer">VcXsrv Windows X Server</a> or a similar X Server (if you use the Chocolatey package manager: <code>choco install vcxsrv</code>).</li>
<li>Run <em>“XLaunch”</em> from the Start Menu, or from <em>“C:\Program Files\VcXsrv\xlaunch.exe”</em>.</li>
<li>Use the default settings, except: <br> <img class="max-w-[400px]" src="/img/tutorials/windows-x11-1.webp"></li>
<li>Check that the X Server is running in the tray: <br> <img class="max-w-[400px]" src="/img/tutorials/windows-x11-2.webp"></li>
<li>Install <a href="https://docs.docker.com/desktop/install/windows-install/" target="_blank" rel="noopener noreferrer">Docker Desktop</a>.</li>
<li>Pull the latest Docker image by running:</li>
</ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker pull ghcr.io/spacegaier/volume-cartographer:edge </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Note: this does not install the fork of Volume Cartographer mentioned above.</p><p>Install <a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">Homebrew</a>. Run <code>brew install --no-quarantine educelab/casks/volume-cartographer</code>.</p><ul>
<li>The GUI app will be installed to <code>/Applications/VC.app</code>.</li>
<li>The command line tools are installed to <code>\$(brew --prefix)/bin</code> and should be available in the terminal immediately (e.g. <code>vc_packager</code>) — if not, make sure you have <code>eval \$(/opt/homebrew/bin/brew shellenv)</code> in your shell profile and restart your terminal.</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div>If you prefer Docker, here are the steps:</div><ol>
<li>Install XQuartz: <a href="https://www.xquartz.org/" target="_blank" rel="noopener noreferrer">https://www.xquartz.org/</a></li>
<li>Log out and back into macOS.</li>
<li>Launch XQuartz. Under the XQuartz menu, select <em>“Preferences”</em>.</li>
<li>Go to the <em>“Security”</em> tab and ensure <em>“Allow connections from network clients”</em> is checked.</li>
<li>Quit XQuartz and restart it.</li>
<li>Install <a href="https://docs.docker.com/desktop/install/mac-install/" target="_blank" rel="noopener noreferrer">Docker Desktop</a>.</li>
<li>Pull the latest Docker image by running:</li>
</ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker pull ghcr.io/spacegaier/volume-cartographer:edge </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="8">
<li>Then run:</li>
</ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">xhost +localhost</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>We assume that you’re running the X Window System (if you’re unsure, you probably do).</li>
<li>First, install <a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener noreferrer">Docker</a>. Do <em>not</em> use Snap to install it.</li>
<li>Pull the latest Docker image by running:</li>
</ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker pull ghcr.io/spacegaier/volume-cartographer:edge </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul>
<li>Then run:</li>
</ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">xhost +local:docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>First, install basic <a href="https://github.com/educelab/volume-cartographer/blob/develop/README.md" target="_blank" rel="noopener noreferrer">build dependencies</a> like <code>build-essential</code>, <code>cmake</code>, and Qt6.</li>
<li>Then:</li>
</ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Recursive clone, so we get the vc-deps repo, which contains dependencies.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone --recursive https://github.com/spacegaier/volume-cartographer.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Build vc-deps.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd volume-cartographer/vc-deps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir build &amp;&amp; cd build</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cmake -DCMAKE_BUILD_TYPE=Release ..</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Build main app.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd ../..</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir build &amp;&amp; cd build</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cmake -DVC_PREBUILT_LIBS=ON -DCMAKE_BUILD_TYPE=Release ..</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Install, or skip this and refer directly to the executables in build/bin.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gathering-data">Gathering data<a href="#gathering-data" class="hash-link" aria-label="Direct link to Gathering data" title="Direct link to Gathering data">​</a></h3>
<p>Now let&#x27;s gather our scroll data and setup our folders...</p>
<p>We&#x27;re going to start with Scroll 1 (PHerc. Paris 4) as this is the scroll that the 2023 Grand Prize segments were from, and is also the easiest of the current scrolls to segment. VC requires all of the folders listed under the PHercParis4.volpkg, in addition to the config.json and meta.json files.</p>
<p>This is the recommended structure for the full_scrolls folder (with a full example given for Scroll1):</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">full_scrolls/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ├── Scroll1/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │   └── PHercParis4.volpkg/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       ├── volumes/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       │   └── 20230205180739/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       │       ├── 00000.tif</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       │       ├── .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       │       ├── .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       │       ├── 14375.tif</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       │       └── meta.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       ├── paths</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       ├── renders</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       ├── working</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │       └── config.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ├── Scroll2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │   └── PHercParis3.volpkg/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ├── Scroll3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  │   └── PHerc332.volpkg/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  └── Scroll4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      └── PHerc1667.volpkg/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And this is the recommended structure for your new_segments folder:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">new_segments/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ├── Scroll1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ├── Scroll2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ├── Scroll3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ├── Scroll4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  └── run_vc.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To download the data, first navigate to the <code>/volumes/20230205180739</code> directory. You can also place the files in <code>/volumes/20230205180739</code> after they are downloaded.
Use this <code>rclone</code> command to download all of the Scroll 1 volumes quickly:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">rclone copy :http:/full-scrolls/Scroll1/PHercParis4.volpkg/volumes/20230205180739/ . --http-url https://dl.ash2txt.org/ --progress --size-only</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you wish to begin with a smaller portion of Scroll 1, rather than the entire scroll, you can download 1cm of scan data from the center using:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">for i in `seq 6000 7250`; do wget http://dl.ash2txt.org/full-scrolls/Scroll1/PHercParis4.volpkg/volumes/20230205180739/0\$i.tif; done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Be sure to have the config.json file at the root of the <code>.volpkg</code> directory, and the meta.json file in the <code>volumes</code> directory so that VC can work with it.
More information can be found at the <a href="https://github.com/JamesDarby345/VesuviusDataDownload" target="_blank" rel="noopener noreferrer">Vesuvius Data Download Repo</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-volume-cartographer-gui">Running the Volume Cartographer GUI<a href="#running-the-volume-cartographer-gui" class="hash-link" aria-label="Direct link to Running the Volume Cartographer GUI" title="Direct link to Running the Volume Cartographer GUI">​</a></h3>
<p>We will use the main <code>VC</code> GUI app to perform segmentation: finding a surface of papyrus and exporting it as a 3D mesh.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>This guide was written using Linux. Most of the commands are similar, but you may need to remove &#x27;sudo&#x27; from the front of the commands depending on your operating system.</p><p>The -v switch used below is mapping a local path (or volume) to the Docker container. To check if your paths have been created properly you can run the Docker container and initiate a list command by typing:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker run -v \path\to\full_scrolls\:/full_scrolls ghcr.io/spacegaier/volume-cartographer:edge ls</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you see your scroll folders, you’ve probably mapped this correctly.</p></div></div>
<p>Open a terminal and run (replacing the paths with your folder paths to the same folders):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo docker run -v /path/to/new_segments/:/new_segments -v /path/to/full_scrolls/:/full_scrolls -e DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix ghcr.io/spacegaier/volume-cartographer:edge VC</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s take a moment to get oriented before continuing:</p>
<ol>
<li>In the top left are the current segmentations, or paths, in the current volume package (from here on referred to as a volpkg) along with the file, edit, help and view buttons.</li>
<li>In the bottom left are the current segmentation runs and anchor information for the currently selected segment id.</li>
<li>On the right are your OFS Segmentation settings.</li>
<li>Located at the bottom is some navigation information. The primary number useful to you here will be the current slice number.</li>
</ol>
<figure><img src="/img/tutorials/vc-open.webp" class="rounded-xl"></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="navigating-a-volpkg">Navigating a .volpkg<a href="#navigating-a-volpkg" class="hash-link" aria-label="Direct link to Navigating a .volpkg" title="Direct link to Navigating a .volpkg">​</a></h3>
<p>Now that we’ve oriented ourselves with the UI, let&#x27;s open our .volpkg...</p>
<ol>
<li>Open a .volpkg by clicking file, then open .volpkg, and select the .volpkg for the volume you wish to segment on, ensuring you select the .volpkg folder, and not one of the subfolders. Click choose, and the volume will open at slice 0.</li>
<li>Practice scrolling through the volume, using shift+scroll wheel to move up and down through slice layers, and ctrl+scroll wheel to zoom in and out. You can right click and drag to pan around the slice.   Move through the layers until you find an area of the sheet that looks “easy” to segment. An ideal area has spacing on the inside face towards the center of the scroll, and maintains this spacing as you scroll through the layers for a time. You can increase the amount of slices you move through with the scroll wheel by pressing Q and E. The small number that shows up next to your cursor is the number of slices skipped each “click” of the scroll wheel.</li>
<li>Look now to the top left in the segments window; our VC shows some segmentations in the segmentation window, but yours at this point will be blank.</li>
</ol>
<figure><img src="/img/tutorials/open-volpkg.webp" class="rounded-xl"></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-segment">Creating a segment<a href="#creating-a-segment" class="hash-link" aria-label="Direct link to Creating a segment" title="Direct link to Creating a segment">​</a></h3>
<p>We will now create our first segment.</p>
<p>Click &quot;New&quot; in the Volume Package segmentation window on the top left to create a new segment path. Ensure &quot;Display&quot; and &quot;Compute&quot; are both checked.</p>
<p>Click “Pen Tool”, and place points along the sheet by left clicking, placing as many points as necessary to keep the line on the surface of the sheet. Note that you cannot undo or delete points here. This part does not need to be particularly accurate, as you’ll be able to fix it in the next step much easier. When you are happy with the length of the line, click pen tool once again to exit the pen tool.</p>
<p>You’ll notice now that the purple line becomes a series of points. This is your “segmentation line”. It is from this line that VC will create your final flattened surface volume. Ideally, you want this to be on the inside face of the sheet, as this is where we expect to find ink.</p>
<figure><video autoplay="" playsinline="" loop="" muted="" class="w-[100%] rounded-xl" poster="/img/tutorialwebp"><source src="/img/tutorials/new_pen_tool.webm" type="video/webm"></video><figcaption class="mt-0">Placing our first segmentation line with the pen tool.</figcaption></figure>
<p>Now, click “Segmentation Tool” (You can also enter the segmentation tool by pressing &#x27;T&#x27;). Let’s configure our Segmentation settings in the right box to match the ones in this image. The primary parameter you could modify here and see if you have any improvement is &#x27;smoothen curve at bright points&#x27;.</p>
<figure><img src="/img/tutorials/ofs_settings.webp" class="rounded-xl"></figure>
<p>If at this point your segmentation line is off the sheet, you can manipulate it in a few ways. The primary method for manipulating this line is to “snap” it to a point, by clicking. VC will take the X nearest points to the cursor (where X is the input range setting located in the bottom right, also in/decreased by hitting A and D respectively) and snap them to the cursor. You can also click and drag the line itself. Play around with this for a bit before continuing. In addition to just panning along the line with right click, you can press R+Scroll Wheel to follow the segmentation line automatically. This is also mapped to the front and back side mouse buttons, if you have them.</p>
<p>Once you are happy with the location of the line, ensure your slice and anchor settings are correct. If you’re going “up” in the volume, you want forward slice and backward anchor, and conversely if you&#x27;re going “down” in the volume, you want a forward anchor and “backward slice”. The number in the forward or backward slice is the number the segmentation run will finish at. It is recommended to start low here, between 30 and 50, and depending on how far the line diverges from the sheet, you can increase from there. In areas of particularly damaged papyrus values as low as 10 can be required.</p>
<p>Click “Start” to begin the segmentation run.</p>
<figure><video autoplay="" playsinline="" loop="" muted="" class="w-[100%] rounded-xl" poster="/img/tutorials/new-pen.webp"><source src="/img/tutorials/new_seg_run.webm" type="video/webm"></video><figcaption class="mt-0">&quot;Snapping&quot; our segmentation line back onto the surface of the sheet.</figcaption></figure>
<p>After a short period of time VC will drop you off at the slice indicated by your previous forward or backward slice setting. Your line of points will now be colored red, and may have wandered slightly from the sheet. VC has attempted to “follow” the sheet from your annotation (or anchor) line to the slice indicated in your forward slice setting. From here, click “segmentation tool” again, and then manipulate the line back onto the sheet. You’ll notice lines you have modified turn yellow, where ones you have not remain red. Pan through the layers a bit if you are having a hard time following the sheet, as it&#x27;s easier to follow “in motion”. Press space to hide the line if it helps you see.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>You can press T at any time within the segmentation tool to return to the slice you began the segmentation on.</p></div></div>
<figure><video autoplay="" playsinline="" loop="" muted="" class="w-[100%] rounded-xl" poster="/img/tutorials/new-pen.webp"><source src="/img/tutorials/second_seg_run.webm" type="video/webm"></video><figcaption class="mt-0">&quot;Snapping&quot; our segmentation line back onto the surface of the sheet.</figcaption></figure>
<p>After you’ve guided the line along the sheet, hit “Start” again, and repeat the process. This is the general workflow for segments of any size, from the GP winners at over 100cm^2 to the smallest segments. Conceptually, it works something like this:</p>
<figure><video playsinline="" muted="" controls="" class="max-w-[100%] rounded-xl" poster="/img/tutorials/vc-extrapolation2.webp"><source src="/img/tutorials/vc-extrapolation2.webm" type="video/webm"></video></figure>
<p>Be sure to save it using <em>“File &gt; Save volpkg”</em>. You can keep segmenting for a bit here to get the hang of VC, but keep the size manageable for your first few segments until you get more familiar.</p>
<p>The process completed during this step looks like this in 3D. We&#x27;ve identified the sheet surface, but still would have a hard time finding ink on a single voxel sheet that is still wrapped in the scroll. In the video below, the sheet is on the visible outside, but most of our segments are completely surrounded by additional sheets.</p>
<figure><video autoplay="" playsinline="" loop="" muted="" class="w-[100%] rounded-xl" poster="/img/tutorials/segmentation2.webp"><source src="/img/tutorials/segmentation2.webm" type="video/webm"></video><figcaption class="mt-0">Segmentation: finding a surface of papyrus.</figcaption></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="flattening-and-texturing">Flattening and texturing<a href="#flattening-and-texturing" class="hash-link" aria-label="Direct link to Flattening and texturing" title="Direct link to Flattening and texturing">​</a></h3>
<p>Ok, we&#x27;ve got a line...Now what?</p>
<p>In order to see the content on the surface of our segment, we need to flatten and texture the segment. These steps can be run individually, but it’s highly suggested to use the following process so that you end up with the same format and files as the official segmentations.</p>
<p>Let&#x27;s create a bash script to combine a number of different VC apps into one single command:</p>
<ol>
<li>Open a basic text editor (ex: Notepad)</li>
<li>Copy this code block into the editor</li>
</ol>
<div class="language-BASH language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Set environment variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">export SEGMENT=20240227040603 #change to the segment number you&#x27;ve created</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">export SCROLL=&quot;Scroll1/PHercParis4.volpkg&quot; #change to whatever scroll you are currently working in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Navigate to the segment folder, create a directory named after \$SEGMENT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd \${SCROLL}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p &quot;\${SEGMENT}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd &quot;\${SEGMENT}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Copy necessary files from the scroll folder to the current directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp &quot;/full_scrolls/\${SCROLL}/paths/\${SEGMENT}/pointset.vcps&quot; .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp &quot;/full_scrolls/\${SCROLL}/paths/\${SEGMENT}/meta.json&quot; .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp &quot;/full_scrolls/\${SCROLL}/paths/\${SEGMENT}/pointset.vcano&quot; .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Convert and render pointset, then generate layers and calculate area</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nice vc_convert_pointset -i pointset.vcps -o &quot;\${SEGMENT}_points.obj&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nice vc_render -v &quot;/full_scrolls/\${SCROLL}/&quot; -s &quot;\${SEGMENT}&quot; -o &quot;\${SEGMENT}.obj&quot; --output-ppm &quot;\${SEGMENT}.ppm&quot; --intermediate-mesh &quot;\${SEGMENT}_intermediate_mesh.obj&quot; --save-graph 0 --orient-normals</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p layers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nice vc_layers_from_ppm -v &quot;/full_scrolls/\${SCROLL}&quot; -p &quot;\${SEGMENT}.ppm&quot; --output-dir layers/ -r 32 -f tif --cache-memory-limit 50G</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vc_area &quot;/full_scrolls/\${SCROLL}&quot; \${SEGMENT} | grep cm | awk &#x27;{print \$2}&#x27; | tee area_cm2.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Set author name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo &#x27;&lt;YourNameHere&gt;&#x27; &gt; author.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>
<p>Modify the environment variables at the top of the script, the ones that begin with <code>export</code>, and the author at the bottom. You&#x27;ll want these values to reflect the scroll you&#x27;re working in, the name of your segment, and who you&#x27;d like to list as the author.</p>
</li>
<li>
<p>Name the script <code>run_vc.sh</code> and save it to the &#x27;new_segments&#x27; directory</p>
</li>
</ol>
<p>Once we have our script created and have the right values for the environment variables, we can now execute the flattening pipeline. Open a new terminal (not the one you have the GUI running in), and enter</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo docker run -it -v /path/to/new_segments/:/new_segments -v /path/to/full_scrolls/:/full_scrolls -e DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix ghcr.io/spacegaier/volume-cartographer:edge VC</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The terminal for the container should open. Enter the following lines:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd /new_segments/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/bin/bash run_vc.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This command will render your points into a mesh, and then create the surface volume layers from it. This can take a long time depending on the size of your segment, but thankfully you will get some progress information on the console.</p>
<figure><img src="/img/tutorials/console-output.webp"></figure>
<p><strong>Congratulations! You&#x27;ve completed your first segment!</strong></p>
<p>In the new_segments directory you set when you launched VC, you will now have a folder with the name of your new segment, and within that folder a folder called <code>layers/</code>, and a number of different files, the most important of which are detailed below. Much of this information was gathered from @Seth P. and @khartes_chuck on the discord:</p>
<ul>
<li>
<p><code>layers/</code> contains files numbered 00.tif to 64.tif (or 000.tif to 156.tif for 3.24um scans). These are slices of the surface volume, each of a thickness equal to the voxel size of the scroll you are currently segmenting, typically what we call “low res” are the 7.91um voxel spacing, and “high res” would be 3.24um voxel spacing. For a 7.91um volume, this means that each surface volume is 64 tifs * 7.91um, for about 506um thickness, or .506mm.</p>
</li>
<li>
<p><code>&lt;SegmentNumber&gt;.obj</code> this is a 3D image format that stores information about the geometry of a 3D model, such as vertex positions, texture maps, normals, and faces. This is a mesh created from the pointset created by your segmentation line and detailed further below.</p>
</li>
<li>
<p><code>&lt;SegmentNumber&gt;.tif</code> is a composite image of maximum intensity pixels from within the surface volume, it is also used for texturing in combination with the mtl file.</p>
</li>
<li>
<p><code>&lt;SegmentNumber&gt;.mtl</code> is a text file that contains information about the material, such as opacity, reflectivity, and points to the texture file (the tif in the previous line).</p>
</li>
<li>
<p><code>&lt;SegmentNumber&gt;.ppm</code> A simple way to think about this is to think of it as a super dense point cloud that for each voxel in the flattened volume contains a point representing the 3d location in the original volume that voxel came from, and some information about that point. A better explanation is that a .ppm is special case of an ordered pointset, where type = double and dim = 6. It is generated by flattening the segmented surface, discretizing the parameterization, and storing the corresponding 3D point and surface normal for each spot on the surface. Using slice notation, ppm[y, x, 0:3] stores the 3D point and ppm[y, x, 3:6] stores the surface normal. Because the surface does not fill the 2D array entirely, there is a *_mask.png file next to the PPM. It stores which pixels in the PPM have valid values. More info here: Volume Cartographer PPM file format (github.com)</p>
</li>
<li>
<p><code>&lt;SegmentNumber&gt;_mask.png</code> as detailed in the ppm description, just denotes areas that do not contain information from the scroll data.</p>
</li>
<li>
<p><code>&lt;SegmentNumber&gt;.vcps</code> this is the pointset created by your segmentation line. A .vcps file stores lists or 2D arrays of N-dimensional, numerical vectors. It starts with a header as described, then the points are written in sequence, usually in binary and rarely in ASCII. The type field in the header tells you the fundamental C++ type stored.</p>
</li>
<li>
<p><code>&lt;SegmentNumber&gt;.vcano</code> contains information about which points were manually moved, and their original locations.</p>
</li>
<li>
<p><code>Author.txt</code> contains the name of the person who created it.</p>
</li>
<li>
<p><code>Area_cm2.txt</code> is simply the size of the segment in cm^2.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="outputs">Outputs<a href="#outputs" class="hash-link" aria-label="Direct link to Outputs" title="Direct link to Outputs">​</a></h3>
<p>So, what did we just do?</p>
<p>When looking for ink in the volume, we need to look at more than just the voxels that directly intersect the segment mesh we just created. We also need to look a little bit “above“ and “below“ the mesh, at the neighborhood of voxels that surround our segment. Conceptually, this neighborhood looks something like this (though this video is exaggerated):</p>
<figure><video autoplay="" playsinline="" loop="" muted="" class="w-[100%] rounded-xl" poster="/img/tutorials/surface-volume-extrusion3.webp"><source src="/img/tutorials/surface-volume-extrusion3.webm" type="video/webm"></video><figcaption class="mt-0">Building a neighborhood of voxels around our segment. Everything inside the neighborhood is used for texturing.</figcaption></figure>
<p>To generate the composite .tif file, called <code>&lt;SegmentNumber&gt;.tif</code>, <code>vc_render</code> searched through this neighborhood, gathering the voxel intensities, and placed the results of that search in the flattened output image.</p>
<p>The ppm file that we generated contains a mapping between our flattened output image and the original 3D surface. With this file, we transformed the 3D neighborhood into a simplified surface volume. That process looks something like this:</p>
<figure><video autoplay="" playsinline="" loop="" muted="" class="w-[100%] rounded-xl" poster="/img/tutorials/surface-volume-flattening4.webp"><source src="/img/tutorials/surface-volume-flattening4.webm" type="video/webm"></video><figcaption class="mt-0">Flattening of the subvolume.</figcaption></figure>
<p>The result of this process are the 65 tifs in the /layers/ directory. Each of these .tif images is a &quot;slice&quot; of the surface volume, with 32.tif ideally representing the middle, or the area directly on your segmentation line.</p>
<figure><video autoplay="" playsinline="" loop="" muted="" class="w-[100%] rounded-xl" poster="/img/tutorials/surface-volume-image-stack2.webp"><source src="/img/tutorials/surface-volume-image-stack2.webm" type="video/webm"></video><figcaption class="mt-0">The resulting “surface volume” is your .tif image stack in the /layers/ directory.</figcaption></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ink-detection">Ink detection<a href="#ink-detection" class="hash-link" aria-label="Direct link to Ink detection" title="Direct link to Ink detection">​</a></h3>
<p>So, where&#x27;s the ink?</p>
<p>By now you&#x27;ll notice that, contrary to the ink in some scrolls, the ink in our scrolls is not readily detectable in your images.</p>
<p>The reason for this is that not all inks have the same radio-density. Some inks, like iron gall, show up quite clearly in CT scans because they absorb more x-rays than the papyrus on which they sit. This creates <em>high contrast</em> between the bright iron gall ink voxels and the less bright papyrus voxels. Carbon-based inks, on the other hand, have a very similar radio-density to papyrus and thus have <em>low contrast</em> when compared against the papyrus voxels. More often than not, the contrast is so low for carbon ink that it is very difficult to differentiate the ink from the papyrus when looking at the volume data with the naked eye.</p>
<p>Thankfully, as you&#x27;ll learn in our next tutorial on <a href="/deeppast/tutorial4">“Ink Detection”</a>, even very difficult to detect ink can still be found...</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ScrollPrize/villa/tree/main/scrollprize.org/docs/06_tutorial3.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Overview</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/deeppast/get_started">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Deep Past Challenge.</div></div></div></footer></div>
</body>
</html>