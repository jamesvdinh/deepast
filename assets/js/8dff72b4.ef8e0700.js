"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1202],{5537:(e,t,n)=>{n.d(t,{A:()=>y});var r=n(6540),s=n(4164),o=n(5627),i=n(6347),a=n(372),l=n(604),c=n(1861),h=n(8749);function d(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return d(e).map((({props:{value:e,label:t,attributes:n,default:r}})=>({value:e,label:t,attributes:n,default:r})))}(n);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m({value:e,tabValues:t}){return t.some((t=>t.value===e))}function p({queryString:e=!1,groupId:t}){const n=(0,i.W6)(),s=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,l.aZ)(s),(0,r.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(n.location.search);t.set(s,e),n.replace({...n.location,search:t.toString()})}),[s,n])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:s}=e,o=u(e),[i,l]=(0,r.useState)((()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find((e=>e.default))??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:o}))),[c,d]=p({queryString:n,groupId:s}),[g,f]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,s]=(0,h.Dv)(t);return[n,(0,r.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:s}),x=(()=>{const e=c??g;return m({value:e,tabValues:o})?e:null})();(0,a.A)((()=>{x&&l(x)}),[x]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),f(e)}),[d,f,o]),tabValues:o}}var f=n(9136);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=n(4848);function v({className:e,block:t,selectedValue:n,selectValue:r,tabValues:i}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),c=e=>{const t=e.currentTarget,s=a.indexOf(t),o=i[s].value;o!==n&&(l(t),r(o))},h=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=a.indexOf(e.currentTarget)+1;t=a[n]??a[0];break}case"ArrowLeft":{const n=a.indexOf(e.currentTarget)-1;t=a[n]??a[a.length-1];break}}t?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},e),children:i.map((({value:e,label:t,attributes:r})=>(0,j.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{a.push(e)},onKeyDown:h,onClick:c,...r,className:(0,s.A)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":n===e}),children:t??e},e)))})}function b({lazy:e,children:t,selectedValue:n}){const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=o.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n})))})}function w(e){const t=g(e);return(0,j.jsxs)("div",{className:(0,s.A)("tabs-container",x.tabList),children:[(0,j.jsx)(v,{...t,...e}),(0,j.jsx)(b,{...t,...e})]})}function y(e){const t=(0,f.A)();return(0,j.jsx)(w,{...e,children:d(e.children)},String(t))}},6992:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>c,default:()=>m,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"tutorial_VC","title":"Volume Cartographer (Segmentation)","description":"<meta","source":"@site/docs/06_tutorial_VC.md","sourceDirName":".","slug":"/tutorial_VC","permalink":"/tutorial_VC","draft":false,"unlisted":false,"editUrl":"https://github.com/ScrollPrize/villa/tree/main/scrollprize.org/docs/06_tutorial_VC.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Volume Cartographer (Segmentation)","hide_table_of_contents":true}}');var s=n(4848),o=n(8453),i=n(5537),a=n(9329);const l={title:"Volume Cartographer (Segmentation)",hide_table_of_contents:!0},c=void 0,h={},d=[{value:"Installing Volume Cartographer",id:"installing-volume-cartographer",level:3},{value:"Gathering data",id:"gathering-data",level:3},{value:"Running the Volume Cartographer GUI",id:"running-the-volume-cartographer-gui",level:3},{value:"Navigating a .volpkg",id:"navigating-a-volpkg",level:3},{value:"Creating a segment",id:"creating-a-segment",level:3},{value:"Flattening and texturing",id:"flattening-and-texturing",level:3},{value:"Outputs",id:"outputs",level:3}];function u(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{Head:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n,{children:[(0,s.jsx)("html",{"data-theme":"dark"}),(0,s.jsx)("meta",{name:"description",content:"A $1,000,000+ machine learning and computer vision competition"}),(0,s.jsx)("meta",{property:"og:type",content:"website"}),(0,s.jsx)("meta",{property:"og:url",content:"https://scrollprize.org"}),(0,s.jsx)("meta",{property:"og:title",content:"Vesuvius Challenge"}),(0,s.jsx)("meta",{property:"og:description",content:"A $1,000,000+ machine learning and computer vision competition"}),(0,s.jsx)("meta",{property:"og:image",content:"https://scrollprize.org/img/social/opengraph.jpg"}),(0,s.jsx)("meta",{property:"twitter:card",content:"summary_large_image"}),(0,s.jsx)("meta",{property:"twitter:url",content:"https://scrollprize.org"}),(0,s.jsx)("meta",{property:"twitter:title",content:"Vesuvius Challenge"}),(0,s.jsx)("meta",{property:"twitter:description",content:"A $1,000,000+ machine learning and computer vision competition"}),(0,s.jsx)("meta",{property:"twitter:image",content:"https://scrollprize.org/img/social/opengraph.jpg"})]}),"\n","\n",(0,s.jsxs)(t.p,{children:["Volume Cartographer was used to generate the 2023 ",(0,s.jsx)(t.a,{href:"grandprize",children:"Grand Prize results"}),". This guide was made by @bruniss with feedback and help from @hari_seldon and @djosey of the segmentation team."]}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsxs)(t.p,{children:["Please see the accompanying video tutorial for segmentation using Volume Cartographer here: ",(0,s.jsx)(t.a,{href:"https://www.youtube.com/watch?v=gdQmepxWhuY",children:"https://www.youtube.com/watch?v=gdQmepxWhuY"})]})}),"\n",(0,s.jsx)(t.p,{children:"Volume Cartographer has been a popular option for manual segmentation."}),"\n",(0,s.jsx)(t.p,{children:"Strengths:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Fastest manual tool for creating accurate, large segments"}),"\n",(0,s.jsx)(t.li,{children:"Tool-assisted annotation, requiring less clicking"}),"\n",(0,s.jsx)(t.li,{children:"Entire pipeline in one application"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Weaknesses:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Can only segment on the Z plane, which is a challenge in some areas"}),"\n",(0,s.jsx)(t.li,{children:"No preview during segmentation"}),"\n",(0,s.jsx)(t.li,{children:"Relatively high hardware requirements"}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["This guide will focus on ",(0,s.jsx)(t.a,{href:"https://github.com/educelab/volume-cartographer",children:"Volume Cartographer"}),", a virtual unwrapping toolkit built by EduceLab\u2019s Seth Parker. Volume Cartographer is designed to create meshes along surfaces of a manuscript (e.g. pages or scroll wraps) and then sample the voxels around these meshes to create a 2D image of the manuscript's contents. Volume Cartographer includes many tools and utilities. In this tutorial we\u2019ll be looking at the main VC GUI as well as the vc_render tool."]}),"\n",(0,s.jsxs)(t.p,{children:["The segmentation team uses a custom version of Volume Cartographer, initially forked by @RICHI and further enhanced by @spacegaier. These versions include significant improvements, such as Optical Flow Segmentation (OFS), substantial performance increases, ui improvements, and many other changes. The latest fork, maintained by @spacegaier, is available here: ",(0,s.jsx)(t.a,{href:"https://github.com/spacegaier/volume-cartographer",children:"https://github.com/spacegaier/volume-cartographer"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"This guide uses this same version of VC. If you use a different version this guide will vary significantly from your experience, so it is highly recommended to use this version."}),"\n",(0,s.jsx)(t.h3,{id:"installing-volume-cartographer",children:"Installing Volume Cartographer"}),"\n",(0,s.jsx)(t.p,{children:"To begin, let's install Volume Cartographer:"}),"\n",(0,s.jsx)(t.admonition,{title:"OS-specific instructions",type:"info",children:(0,s.jsxs)(i.A,{groupId:"operating-systems",children:[(0,s.jsxs)(a.A,{value:"win",label:"Windows",children:[(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Install the ",(0,s.jsx)(t.a,{href:"https://sourceforge.net/projects/vcxsrv/",children:"VcXsrv Windows X Server"})," or a similar X Server (if you use the Chocolatey package manager: ",(0,s.jsx)(t.code,{children:"choco install vcxsrv"}),")."]}),"\n",(0,s.jsxs)(t.li,{children:["Run ",(0,s.jsx)(t.em,{children:"\u201cXLaunch\u201d"})," from the Start Menu, or from ",(0,s.jsx)(t.em,{children:"\u201cC:\\Program Files\\VcXsrv\\xlaunch.exe\u201d"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Use the default settings, except: ",(0,s.jsx)("br",{})," ",(0,s.jsx)("img",{className:"max-w-[400px]",src:"/img/tutorials/windows-x11-1.webp"})]}),"\n",(0,s.jsxs)(t.li,{children:["Check that the X Server is running in the tray: ",(0,s.jsx)("br",{})," ",(0,s.jsx)("img",{className:"max-w-[400px]",src:"/img/tutorials/windows-x11-2.webp"})]}),"\n",(0,s.jsxs)(t.li,{children:["Install ",(0,s.jsx)(t.a,{href:"https://docs.docker.com/desktop/install/windows-install/",children:"Docker Desktop"}),"."]}),"\n",(0,s.jsx)(t.li,{children:"Pull the latest Docker image by running:"}),"\n"]}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"docker pull ghcr.io/spacegaier/volume-cartographer:edge \n"})})]}),(0,s.jsxs)(a.A,{value:"mac",label:"macOS (using Homebrew)",children:[(0,s.jsx)(t.p,{children:"Note: this does not install the fork of Volume Cartographer mentioned above."}),(0,s.jsxs)(t.p,{children:["Install ",(0,s.jsx)(t.a,{href:"https://brew.sh/",children:"Homebrew"}),". Run ",(0,s.jsx)(t.code,{children:"brew install --no-quarantine educelab/casks/volume-cartographer"}),"."]}),(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["The GUI app will be installed to ",(0,s.jsx)(t.code,{children:"/Applications/VC.app"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["The command line tools are installed to ",(0,s.jsx)(t.code,{children:"\\$(brew --prefix)/bin"})," and should be available in the terminal immediately (e.g. ",(0,s.jsx)(t.code,{children:"vc_packager"}),") \u2014 if not, make sure you have ",(0,s.jsx)(t.code,{children:"eval \\$(/opt/homebrew/bin/brew shellenv)"})," in your shell profile and restart your terminal."]}),"\n"]})]}),(0,s.jsxs)(a.A,{value:"mac_docker",label:"macOS (using Docker)",children:[(0,s.jsx)("div",{children:"If you prefer Docker, here are the steps:"}),(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Install XQuartz: ",(0,s.jsx)(t.a,{href:"https://www.xquartz.org/",children:"https://www.xquartz.org/"})]}),"\n",(0,s.jsx)(t.li,{children:"Log out and back into macOS."}),"\n",(0,s.jsxs)(t.li,{children:["Launch XQuartz. Under the XQuartz menu, select ",(0,s.jsx)(t.em,{children:"\u201cPreferences\u201d"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Go to the ",(0,s.jsx)(t.em,{children:"\u201cSecurity\u201d"})," tab and ensure ",(0,s.jsx)(t.em,{children:"\u201cAllow connections from network clients\u201d"})," is checked."]}),"\n",(0,s.jsx)(t.li,{children:"Quit XQuartz and restart it."}),"\n",(0,s.jsxs)(t.li,{children:["Install ",(0,s.jsx)(t.a,{href:"https://docs.docker.com/desktop/install/mac-install/",children:"Docker Desktop"}),"."]}),"\n",(0,s.jsx)(t.li,{children:"Pull the latest Docker image by running:"}),"\n"]}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"docker pull ghcr.io/spacegaier/volume-cartographer:edge \n"})}),(0,s.jsxs)(t.ol,{start:"8",children:["\n",(0,s.jsx)(t.li,{children:"Then run:"}),"\n"]}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"xhost +localhost\n"})})]}),(0,s.jsxs)(a.A,{value:"linux",label:"Linux",children:[(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"We assume that you\u2019re running the X Window System (if you\u2019re unsure, you probably do)."}),"\n",(0,s.jsxs)(t.li,{children:["First, install ",(0,s.jsx)(t.a,{href:"https://docs.docker.com/engine/install/",children:"Docker"}),". Do ",(0,s.jsx)(t.em,{children:"not"})," use Snap to install it."]}),"\n",(0,s.jsx)(t.li,{children:"Pull the latest Docker image by running:"}),"\n"]}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"docker pull ghcr.io/spacegaier/volume-cartographer:edge \n"})}),(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Then run:"}),"\n"]}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"xhost +local:docker\n"})})]}),(0,s.jsxs)(a.A,{value:"source",label:"Build from source",children:[(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["First, install basic ",(0,s.jsx)(t.a,{href:"https://github.com/educelab/volume-cartographer/blob/develop/README.md",children:"build dependencies"})," like ",(0,s.jsx)(t.code,{children:"build-essential"}),", ",(0,s.jsx)(t.code,{children:"cmake"}),", and Qt6."]}),"\n",(0,s.jsx)(t.li,{children:"Then:"}),"\n"]}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"# Recursive clone, so we get the vc-deps repo, which contains dependencies.\ngit clone --recursive https://github.com/spacegaier/volume-cartographer.git\n\n# Build vc-deps.\ncd volume-cartographer/vc-deps\nmkdir build && cd build\ncmake -DCMAKE_BUILD_TYPE=Release ..\nmake -j\n\n# Build main app.\ncd ../..\nmkdir build && cd build\ncmake -DVC_PREBUILT_LIBS=ON -DCMAKE_BUILD_TYPE=Release ..\nmake -j\n\n# Install, or skip this and refer directly to the executables in build/bin.\nmake install\n"})})]})]})}),"\n",(0,s.jsx)(t.h3,{id:"gathering-data",children:"Gathering data"}),"\n",(0,s.jsx)(t.p,{children:"Now let's gather our scroll data and setup our folders..."}),"\n",(0,s.jsx)(t.p,{children:"We're going to start with Scroll 1 (PHerc. Paris 4) as this is the scroll that the 2023 Grand Prize segments were from, and is also the easiest of the current scrolls to segment. VC requires all of the folders listed under the PHercParis4.volpkg, in addition to the config.json and meta.json files."}),"\n",(0,s.jsx)(t.p,{children:"This is the recommended structure for the full_scrolls folder (with a full example given for Scroll1):"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"full_scrolls/\n  \u251c\u2500\u2500 Scroll1/\n  \u2502   \u2514\u2500\u2500 PHercParis4.volpkg/\n  \u2502       \u251c\u2500\u2500 volumes/\n  \u2502       \u2502   \u2514\u2500\u2500 20230205180739/\n  \u2502       \u2502       \u251c\u2500\u2500 00000.tif\n  \u2502       \u2502       \u251c\u2500\u2500 .\n  \u2502       \u2502       \u251c\u2500\u2500 .\n  \u2502       \u2502       \u251c\u2500\u2500 14375.tif\n  \u2502       \u2502       \u2514\u2500\u2500 meta.json\n  \u2502       \u251c\u2500\u2500 paths\n  \u2502       \u251c\u2500\u2500 renders\n  \u2502       \u251c\u2500\u2500 working\n  \u2502       \u2514\u2500\u2500 config.json\n  \u251c\u2500\u2500 Scroll2\n  \u2502   \u2514\u2500\u2500 PHercParis3.volpkg/\n  \u251c\u2500\u2500 Scroll3\n  \u2502   \u2514\u2500\u2500 PHerc332.volpkg/\n  \u2514\u2500\u2500 Scroll4\n      \u2514\u2500\u2500 PHerc1667.volpkg/\n"})}),"\n",(0,s.jsx)(t.p,{children:"And this is the recommended structure for your new_segments folder:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"new_segments/\n  \u251c\u2500\u2500 Scroll1\n  \u251c\u2500\u2500 Scroll2\n  \u251c\u2500\u2500 Scroll3\n  \u251c\u2500\u2500 Scroll4\n  \u2514\u2500\u2500 run_vc.sh\n"})}),"\n",(0,s.jsxs)(t.p,{children:["To download the data, first navigate to the ",(0,s.jsx)(t.code,{children:"/volumes/20230205180739"})," directory. You can also place the files in ",(0,s.jsx)(t.code,{children:"/volumes/20230205180739"})," after they are downloaded.\nUse this ",(0,s.jsx)(t.code,{children:"rclone"})," command to download all of the Scroll 1 volumes quickly:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"rclone copy :http:/full-scrolls/Scroll1/PHercParis4.volpkg/volumes/20230205180739/ . --http-url https://dl.ash2txt.org/ --progress --size-only\n"})}),"\n",(0,s.jsx)(t.p,{children:"If you wish to begin with a smaller portion of Scroll 1, rather than the entire scroll, you can download 1cm of scan data from the center using:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"for i in `seq 6000 7250`; do wget http://dl.ash2txt.org/full-scrolls/Scroll1/PHercParis4.volpkg/volumes/20230205180739/0\\$i.tif; done\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Be sure to have the config.json file at the root of the ",(0,s.jsx)(t.code,{children:".volpkg"})," directory, and the meta.json file in the ",(0,s.jsx)(t.code,{children:"volumes"})," directory so that VC can work with it.\nMore information can be found at the ",(0,s.jsx)(t.a,{href:"https://github.com/JamesDarby345/VesuviusDataDownload",children:"Vesuvius Data Download Repo"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"running-the-volume-cartographer-gui",children:"Running the Volume Cartographer GUI"}),"\n",(0,s.jsxs)(t.p,{children:["We will use the main ",(0,s.jsx)(t.code,{children:"VC"})," GUI app to perform segmentation: finding a surface of papyrus and exporting it as a 3D mesh."]}),"\n",(0,s.jsxs)(t.admonition,{type:"tip",children:[(0,s.jsx)(t.p,{children:"This guide was written using Linux. Most of the commands are similar, but you may need to remove 'sudo' from the front of the commands depending on your operating system."}),(0,s.jsx)(t.p,{children:"The -v switch used below is mapping a local path (or volume) to the Docker container. To check if your paths have been created properly you can run the Docker container and initiate a list command by typing:"}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"docker run -v \\path\\to\\full_scrolls\\:/full_scrolls ghcr.io/spacegaier/volume-cartographer:edge ls\n"})}),(0,s.jsx)(t.p,{children:"If you see your scroll folders, you\u2019ve probably mapped this correctly."})]}),"\n",(0,s.jsx)(t.p,{children:"Open a terminal and run (replacing the paths with your folder paths to the same folders):"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"sudo docker run -v /path/to/new_segments/:/new_segments -v /path/to/full_scrolls/:/full_scrolls -e DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix ghcr.io/spacegaier/volume-cartographer:edge VC\n"})}),"\n",(0,s.jsx)(t.p,{children:"Let's take a moment to get oriented before continuing:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"In the top left are the current segmentations, or paths, in the current volume package (from here on referred to as a volpkg) along with the file, edit, help and view buttons."}),"\n",(0,s.jsx)(t.li,{children:"In the bottom left are the current segmentation runs and anchor information for the currently selected segment id."}),"\n",(0,s.jsx)(t.li,{children:"On the right are your OFS Segmentation settings."}),"\n",(0,s.jsx)(t.li,{children:"Located at the bottom is some navigation information. The primary number useful to you here will be the current slice number."}),"\n"]}),"\n",(0,s.jsx)("figure",{children:(0,s.jsx)("img",{src:"/img/tutorials/vc-open.webp",className:"rounded-xl"})}),"\n",(0,s.jsx)(t.h3,{id:"navigating-a-volpkg",children:"Navigating a .volpkg"}),"\n",(0,s.jsx)(t.p,{children:"Now that we\u2019ve oriented ourselves with the UI, let's open our .volpkg..."}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Open a .volpkg by clicking file, then open .volpkg, and select the .volpkg for the volume you wish to segment on, ensuring you select the .volpkg folder, and not one of the subfolders. Click choose, and the volume will open at slice 0."}),"\n",(0,s.jsx)(t.li,{children:"Practice scrolling through the volume, using shift+scroll wheel to move up and down through slice layers, and ctrl+scroll wheel to zoom in and out. You can right click and drag to pan around the slice.   Move through the layers until you find an area of the sheet that looks \u201ceasy\u201d to segment. An ideal area has spacing on the inside face towards the center of the scroll, and maintains this spacing as you scroll through the layers for a time. You can increase the amount of slices you move through with the scroll wheel by pressing Q and E. The small number that shows up next to your cursor is the number of slices skipped each \u201cclick\u201d of the scroll wheel."}),"\n",(0,s.jsx)(t.li,{children:"Look now to the top left in the segments window; our VC shows some segmentations in the segmentation window, but yours at this point will be blank."}),"\n"]}),"\n",(0,s.jsx)("figure",{children:(0,s.jsx)("img",{src:"/img/tutorials/open-volpkg.webp",className:"rounded-xl"})}),"\n",(0,s.jsx)(t.h3,{id:"creating-a-segment",children:"Creating a segment"}),"\n",(0,s.jsx)(t.p,{children:"We will now create our first segment."}),"\n",(0,s.jsx)(t.p,{children:'Click "New" in the Volume Package segmentation window on the top left to create a new segment path. Ensure "Display" and "Compute" are both checked.'}),"\n",(0,s.jsx)(t.p,{children:"Click \u201cPen Tool\u201d, and place points along the sheet by left clicking, placing as many points as necessary to keep the line on the surface of the sheet. Note that you cannot undo or delete points here. This part does not need to be particularly accurate, as you\u2019ll be able to fix it in the next step much easier. When you are happy with the length of the line, click pen tool once again to exit the pen tool."}),"\n",(0,s.jsx)(t.p,{children:"You\u2019ll notice now that the purple line becomes a series of points. This is your \u201csegmentation line\u201d. It is from this line that VC will create your final flattened surface volume. Ideally, you want this to be on the inside face of the sheet, as this is where we expect to find ink."}),"\n",(0,s.jsxs)("figure",{children:[(0,s.jsx)("video",{autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:"w-[100%] rounded-xl",poster:"/img/tutorials/new-pen.webp",children:(0,s.jsx)("source",{src:"/img/tutorials/new_pen_tool.webm",type:"video/webm"})}),(0,s.jsx)("figcaption",{className:"mt-0",children:"Placing our first segmentation line with the pen tool."})]}),"\n",(0,s.jsx)(t.p,{children:"Now, click \u201cSegmentation Tool\u201d (You can also enter the segmentation tool by pressing 'T'). Let\u2019s configure our Segmentation settings in the right box to match the ones in this image. The primary parameter you could modify here and see if you have any improvement is 'smoothen curve at bright points'."}),"\n",(0,s.jsx)("figure",{children:(0,s.jsx)("img",{src:"/img/tutorials/ofs_settings.webp",className:"rounded-xl"})}),"\n",(0,s.jsx)(t.p,{children:"If at this point your segmentation line is off the sheet, you can manipulate it in a few ways. The primary method for manipulating this line is to \u201csnap\u201d it to a point, by clicking. VC will take the X nearest points to the cursor (where X is the input range setting located in the bottom right, also in/decreased by hitting A and D respectively) and snap them to the cursor. You can also click and drag the line itself. Play around with this for a bit before continuing. In addition to just panning along the line with right click, you can press R+Scroll Wheel to follow the segmentation line automatically. This is also mapped to the front and back side mouse buttons, if you have them."}),"\n",(0,s.jsx)(t.p,{children:"Once you are happy with the location of the line, ensure your slice and anchor settings are correct. If you\u2019re going \u201cup\u201d in the volume, you want forward slice and backward anchor, and conversely if you're going \u201cdown\u201d in the volume, you want a forward anchor and \u201cbackward slice\u201d. The number in the forward or backward slice is the number the segmentation run will finish at. It is recommended to start low here, between 30 and 50, and depending on how far the line diverges from the sheet, you can increase from there. In areas of particularly damaged papyrus values as low as 10 can be required."}),"\n",(0,s.jsx)(t.p,{children:"Click \u201cStart\u201d to begin the segmentation run."}),"\n",(0,s.jsxs)("figure",{children:[(0,s.jsx)("video",{autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:"w-[100%] rounded-xl",poster:"/img/tutorials/new-pen.webp",children:(0,s.jsx)("source",{src:"/img/tutorials/new_seg_run.webm",type:"video/webm"})}),(0,s.jsx)("figcaption",{className:"mt-0",children:'"Snapping" our segmentation line back onto the surface of the sheet.'})]}),"\n",(0,s.jsx)(t.p,{children:"After a short period of time VC will drop you off at the slice indicated by your previous forward or backward slice setting. Your line of points will now be colored red, and may have wandered slightly from the sheet. VC has attempted to \u201cfollow\u201d the sheet from your annotation (or anchor) line to the slice indicated in your forward slice setting. From here, click \u201csegmentation tool\u201d again, and then manipulate the line back onto the sheet. You\u2019ll notice lines you have modified turn yellow, where ones you have not remain red. Pan through the layers a bit if you are having a hard time following the sheet, as it's easier to follow \u201cin motion\u201d. Press space to hide the line if it helps you see."}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsx)(t.p,{children:"You can press T at any time within the segmentation tool to return to the slice you began the segmentation on."})}),"\n",(0,s.jsxs)("figure",{children:[(0,s.jsx)("video",{autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:"w-[100%] rounded-xl",poster:"/img/tutorials/new-pen.webp",children:(0,s.jsx)("source",{src:"/img/tutorials/second_seg_run.webm",type:"video/webm"})}),(0,s.jsx)("figcaption",{className:"mt-0",children:'"Snapping" our segmentation line back onto the surface of the sheet.'})]}),"\n",(0,s.jsx)(t.p,{children:"After you\u2019ve guided the line along the sheet, hit \u201cStart\u201d again, and repeat the process. This is the general workflow for segments of any size, from the GP winners at over 100cm^2 to the smallest segments. Conceptually, it works something like this:"}),"\n",(0,s.jsx)("figure",{children:(0,s.jsx)("video",{playsInline:!0,muted:!0,controls:!0,className:"max-w-[100%] rounded-xl",poster:"/img/tutorials/vc-extrapolation2.webp",children:(0,s.jsx)("source",{src:"/img/tutorials/vc-extrapolation2.webm",type:"video/webm"})})}),"\n",(0,s.jsxs)(t.p,{children:["Be sure to save it using ",(0,s.jsx)(t.em,{children:"\u201cFile > Save volpkg\u201d"}),". You can keep segmenting for a bit here to get the hang of VC, but keep the size manageable for your first few segments until you get more familiar."]}),"\n",(0,s.jsx)(t.p,{children:"The process completed during this step looks like this in 3D. We've identified the sheet surface, but still would have a hard time finding ink on a single voxel sheet that is still wrapped in the scroll. In the video below, the sheet is on the visible outside, but most of our segments are completely surrounded by additional sheets."}),"\n",(0,s.jsxs)("figure",{children:[(0,s.jsx)("video",{autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:"w-[100%] rounded-xl",poster:"/img/tutorials/segmentation2.webp",children:(0,s.jsx)("source",{src:"/img/tutorials/segmentation2.webm",type:"video/webm"})}),(0,s.jsx)("figcaption",{className:"mt-0",children:"Segmentation: finding a surface of papyrus."})]}),"\n",(0,s.jsx)(t.h3,{id:"flattening-and-texturing",children:"Flattening and texturing"}),"\n",(0,s.jsx)(t.p,{children:"Ok, we've got a line...Now what?"}),"\n",(0,s.jsx)(t.p,{children:"In order to see the content on the surface of our segment, we need to flatten and texture the segment. These steps can be run individually, but it\u2019s highly suggested to use the following process so that you end up with the same format and files as the official segmentations."}),"\n",(0,s.jsx)(t.p,{children:"Let's create a bash script to combine a number of different VC apps into one single command:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Open a basic text editor (ex: Notepad)"}),"\n",(0,s.jsx)(t.li,{children:"Copy this code block into the editor"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-BASH",children:'#!/bin/bash\n\n# Set environment variables\nexport SEGMENT=20240227040603 #change to the segment number you\'ve created\nexport SCROLL="Scroll1/PHercParis4.volpkg" #change to whatever scroll you are currently working in\n\n\n# Navigate to the segment folder, create a directory named after \\$SEGMENT\ncd \\${SCROLL}\nmkdir -p "\\${SEGMENT}"\ncd "\\${SEGMENT}"\n\n# Copy necessary files from the scroll folder to the current directory\ncp "/full_scrolls/\\${SCROLL}/paths/\\${SEGMENT}/pointset.vcps" .\ncp "/full_scrolls/\\${SCROLL}/paths/\\${SEGMENT}/meta.json" .\ncp "/full_scrolls/\\${SCROLL}/paths/\\${SEGMENT}/pointset.vcano" .\n\n# Convert and render pointset, then generate layers and calculate area\nnice vc_convert_pointset -i pointset.vcps -o "\\${SEGMENT}_points.obj"\nnice vc_render -v "/full_scrolls/\\${SCROLL}/" -s "\\${SEGMENT}" -o "\\${SEGMENT}.obj" --output-ppm "\\${SEGMENT}.ppm" --intermediate-mesh "\\${SEGMENT}_intermediate_mesh.obj" --save-graph 0 --orient-normals\n\nmkdir -p layers\nnice vc_layers_from_ppm -v "/full_scrolls/\\${SCROLL}" -p "\\${SEGMENT}.ppm" --output-dir layers/ -r 32 -f tif --cache-memory-limit 50G\n\nvc_area "/full_scrolls/\\${SCROLL}" \\${SEGMENT} | grep cm | awk \'{print \\$2}\' | tee area_cm2.txt\n\n# Set author name\necho \'<YourNameHere>\' > author.txt\n'})}),"\n",(0,s.jsxs)(t.ol,{start:"3",children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Modify the environment variables at the top of the script, the ones that begin with ",(0,s.jsx)(t.code,{children:"export"}),", and the author at the bottom. You'll want these values to reflect the scroll you're working in, the name of your segment, and who you'd like to list as the author."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Name the script ",(0,s.jsx)(t.code,{children:"run_vc.sh"})," and save it to the 'new_segments' directory"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Once we have our script created and have the right values for the environment variables, we can now execute the flattening pipeline. Open a new terminal (not the one you have the GUI running in), and enter"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"sudo docker run -it -v /path/to/new_segments/:/new_segments -v /path/to/full_scrolls/:/full_scrolls -e DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix ghcr.io/spacegaier/volume-cartographer:edge VC\n"})}),"\n",(0,s.jsx)(t.p,{children:"The terminal for the container should open. Enter the following lines:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"cd /new_segments/\n/bin/bash run_vc.sh\n"})}),"\n",(0,s.jsx)(t.p,{children:"This command will render your points into a mesh, and then create the surface volume layers from it. This can take a long time depending on the size of your segment, but thankfully you will get some progress information on the console."}),"\n",(0,s.jsx)("figure",{children:(0,s.jsx)("img",{src:"/img/tutorials/console-output.webp"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Congratulations! You've completed your first segment!"})}),"\n",(0,s.jsxs)(t.p,{children:["In the new_segments directory you set when you launched VC, you will now have a folder with the name of your new segment, and within that folder a folder called ",(0,s.jsx)(t.code,{children:"layers/"}),", and a number of different files, the most important of which are detailed below. Much of this information was gathered from @Seth P. and @khartes_chuck on the discord:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"layers/"})," contains files numbered 00.tif to 64.tif (or 000.tif to 156.tif for 3.24um scans). These are slices of the surface volume, each of a thickness equal to the voxel size of the scroll you are currently segmenting, typically what we call \u201clow res\u201d are the 7.91um voxel spacing, and \u201chigh res\u201d would be 3.24um voxel spacing. For a 7.91um volume, this means that each surface volume is 64 tifs * 7.91um, for about 506um thickness, or .506mm."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"<SegmentNumber>.obj"})," this is a 3D image format that stores information about the geometry of a 3D model, such as vertex positions, texture maps, normals, and faces. This is a mesh created from the pointset created by your segmentation line and detailed further below."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"<SegmentNumber>.tif"})," is a composite image of maximum intensity pixels from within the surface volume, it is also used for texturing in combination with the mtl file."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"<SegmentNumber>.mtl"})," is a text file that contains information about the material, such as opacity, reflectivity, and points to the texture file (the tif in the previous line)."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"<SegmentNumber>.ppm"})," A simple way to think about this is to think of it as a super dense point cloud that for each voxel in the flattened volume contains a point representing the 3d location in the original volume that voxel came from, and some information about that point. A better explanation is that a .ppm is special case of an ordered pointset, where type = double and dim = 6. It is generated by flattening the segmented surface, discretizing the parameterization, and storing the corresponding 3D point and surface normal for each spot on the surface. Using slice notation, ppm[y, x, 0:3] stores the 3D point and ppm[y, x, 3:6] stores the surface normal. Because the surface does not fill the 2D array entirely, there is a *_mask.png file next to the PPM. It stores which pixels in the PPM have valid values. More info here: Volume Cartographer PPM file format (github.com)"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"<SegmentNumber>_mask.png"})," as detailed in the ppm description, just denotes areas that do not contain information from the scroll data."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"<SegmentNumber>.vcps"})," this is the pointset created by your segmentation line. A .vcps file stores lists or 2D arrays of N-dimensional, numerical vectors. It starts with a header as described, then the points are written in sequence, usually in binary and rarely in ASCII. The type field in the header tells you the fundamental C++ type stored."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"<SegmentNumber>.vcano"})," contains information about which points were manually moved, and their original locations."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"Author.txt"})," contains the name of the person who created it."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"Area_cm2.txt"})," is simply the size of the segment in cm^2."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"outputs",children:"Outputs"}),"\n",(0,s.jsx)(t.p,{children:"So, what did we just do?"}),"\n",(0,s.jsx)(t.p,{children:"When looking for ink in the volume, we need to look at more than just the voxels that directly intersect the segment mesh we just created. We also need to look a little bit \u201cabove\u201c and \u201cbelow\u201c the mesh, at the neighborhood of voxels that surround our segment. Conceptually, this neighborhood looks something like this (though this video is exaggerated):"}),"\n",(0,s.jsxs)("figure",{children:[(0,s.jsx)("video",{autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:"w-[100%] rounded-xl",poster:"/img/tutorials/surface-volume-extrusion3.webp",children:(0,s.jsx)("source",{src:"/img/tutorials/surface-volume-extrusion3.webm",type:"video/webm"})}),(0,s.jsx)("figcaption",{className:"mt-0",children:"Building a neighborhood of voxels around our segment. Everything inside the neighborhood is used for texturing."})]}),"\n",(0,s.jsxs)(t.p,{children:["To generate the composite .tif file, called ",(0,s.jsx)(t.code,{children:"<SegmentNumber>.tif"}),", ",(0,s.jsx)(t.code,{children:"vc_render"})," searched through this neighborhood, gathering the voxel intensities, and placed the results of that search in the flattened output image."]}),"\n",(0,s.jsx)(t.p,{children:"The ppm file that we generated contains a mapping between our flattened output image and the original 3D surface. With this file, we transformed the 3D neighborhood into a simplified flattened volume. That process looks something like this:"}),"\n",(0,s.jsxs)("figure",{children:[(0,s.jsx)("video",{autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:"w-[100%] rounded-xl",poster:"/img/tutorials/surface-volume-flattening4.webp",children:(0,s.jsx)("source",{src:"/img/tutorials/surface-volume-flattening4.webm",type:"video/webm"})}),(0,s.jsx)("figcaption",{className:"mt-0",children:"Flattening of the subvolume."})]}),"\n",(0,s.jsx)(t.p,{children:'The result of this process are the 65 tifs in the /layers/ directory, also referred to as a "surface volume". Each of these .tif images is a "slice" of the surface volume, with 32.tif ideally representing the middle, or the area directly on your segmentation line.'}),"\n",(0,s.jsxs)("figure",{children:[(0,s.jsx)("video",{autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:"w-[100%] rounded-xl",poster:"/img/tutorials/surface-volume-image-stack2.webp",children:(0,s.jsx)("source",{src:"/img/tutorials/surface-volume-image-stack2.webm",type:"video/webm"})}),(0,s.jsx)("figcaption",{className:"mt-0",children:"The resulting \u201csurface volume\u201d is your .tif image stack in the /layers/ directory."})]})]})}function m(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>a});var r=n(6540);const s={},o=r.createContext(s);function i(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:t},e.children)}},9329:(e,t,n)=>{n.d(t,{A:()=>i});n(6540);var r=n(4164);const s={tabItem:"tabItem_Ymn6"};var o=n(4848);function i({children:e,hidden:t,className:n}){return(0,o.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,n),hidden:t,children:e})}}}]);